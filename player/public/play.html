<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CinePlayer</title>
    <!-- DPlayer CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; background: #000; overflow: hidden; }
        #player { width: 100%; height: 100%; }
        
        .loading {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            z-index: 100;
        }
        .loading.hidden { display: none; }
        .spinner {
            width: 36px;
            height: 36px;
            border: 3px solid rgba(255,255,255,0.2);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .error {
            position: absolute;
            inset: 0;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #000;
            color: rgba(255,255,255,0.6);
            font: 14px system-ui, sans-serif;
            z-index: 100;
        }
        .error.show { display: flex; }
    </style>
</head>
<body>
    <div id="player"></div>
    <div class="loading" id="loading"><div class="spinner"></div></div>
    <div class="error" id="error">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10" opacity="0.5"/>
            <path d="M12 8v4m0 4h.01" stroke-linecap="round"/>
        </svg>
        <p style="margin-top:12px" id="errorText">播放失败</p>
    </div>
    <!-- DPlayer -->
    <script src="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.js"></script>
    <!-- HLS.js -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.12/dist/hls.min.js"></script>
    <!-- CinePlayer SDK -->
    <script src="/dist/cine-player.min.js"></script>
    <script>
        /**
         * CinePlayer 嵌入播放页面
         * 
         * 使用方式：
         * <iframe src="player.html?url=https://example.com/play/video.c3u8" allowfullscreen></iframe>
         * 
         * URL 参数：
         * - url: 视频地址（必需）
         */
        
        (async function() {
            const url = new URLSearchParams(location.search).get('url');
            
            if (!url) {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error').classList.add('show');
                document.getElementById('errorText').textContent = '缺少视频地址';
                return;
            }
            
            try {
                const player = await CinePlayer.create('#player', url, {
                    dpPlayerConfig: {
                        autoplay: true,
                        theme: '#00a1d6',
                        hotkey: true,
                        preload: 'auto',
                        volume: 1
                    }
                });
                player.dp?.on('canplay', () => {
                    document.getElementById('loading').classList.add('hidden');
                });
                // 兜底
                setTimeout(() => {
                    document.getElementById('loading').classList.add('hidden');
                }, 5000);
                
            } catch (e) {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error').classList.add('show');
                document.getElementById('errorText').textContent = e.message || '加载失败';
            }
        })();
    </script>
</body>
</html>
